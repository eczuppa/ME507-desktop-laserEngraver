<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Desktop Laser Engraver: MotionPlanning Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Desktop Laser Engraver
   &#160;<span id="projectnumber">Version 0.01</span>
   </div>
   <div id="projectbrief">A Nucleo L476RG based CNC desktop CoreXY Laser Engraver</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classMotionPlanning-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">MotionPlanning Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>a class that implements a linearly interpolated ramp input generator for a classical control loop <br  />
  
 <a href="classMotionPlanning.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="motionplanning_8h_source.html">motionplanning.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab77d73240b06317f3094028c8adc4b15"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#ab77d73240b06317f3094028c8adc4b15">MotionPlanning</a> (float setpoint_current, float setpoint_last, float feed_setpoint, uint32_t ramp_dt_period)</td></tr>
<tr class="memdesc:ab77d73240b06317f3094028c8adc4b15"><td class="mdescLeft">&#160;</td><td class="mdescRight">boolean for how to adjust the index of the dynamically allocated array which stores the ramp input  <a href="classMotionPlanning.html#ab77d73240b06317f3094028c8adc4b15">More...</a><br /></td></tr>
<tr class="separator:ab77d73240b06317f3094028c8adc4b15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60f1b040d485df34cb53077441568f7b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#a60f1b040d485df34cb53077441568f7b">init_ramp</a> (void)</td></tr>
<tr class="memdesc:a60f1b040d485df34cb53077441568f7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">allocates the memory for the ramp input and initalizes output_pointer  <a href="classMotionPlanning.html#a60f1b040d485df34cb53077441568f7b">More...</a><br /></td></tr>
<tr class="separator:a60f1b040d485df34cb53077441568f7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a547647e630d7c33b11ba73b08013f894"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#a547647e630d7c33b11ba73b08013f894">ramp_generator</a> (void)</td></tr>
<tr class="memdesc:a547647e630d7c33b11ba73b08013f894"><td class="mdescLeft">&#160;</td><td class="mdescRight">generates the ramp input to the control loop as a dyanmic array  <a href="classMotionPlanning.html#a547647e630d7c33b11ba73b08013f894">More...</a><br /></td></tr>
<tr class="separator:a547647e630d7c33b11ba73b08013f894"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdffcdab5159c9f57fbb72b17645b0ac"><td class="memItemLeft" align="right" valign="top"><a id="afdffcdab5159c9f57fbb72b17645b0ac"></a>
float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#afdffcdab5159c9f57fbb72b17645b0ac">get_ramp</a> (void)</td></tr>
<tr class="memdesc:afdffcdab5159c9f57fbb72b17645b0ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">returns the pointer to the first element of the ramp input to the controller <br /></td></tr>
<tr class="separator:afdffcdab5159c9f57fbb72b17645b0ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacc8e431397a8d9b745d7182b86ed415"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#aacc8e431397a8d9b745d7182b86ed415">deinit_ramp</a> (void)</td></tr>
<tr class="memdesc:aacc8e431397a8d9b745d7182b86ed415"><td class="mdescLeft">&#160;</td><td class="mdescRight">deletes the dynamically allocated ramp input array and sets up for the next ramp  <a href="classMotionPlanning.html#aacc8e431397a8d9b745d7182b86ed415">More...</a><br /></td></tr>
<tr class="separator:aacc8e431397a8d9b745d7182b86ed415"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f34b061518d2d9f7b3bd2f57f29e2ce"><td class="memItemLeft" align="right" valign="top"><a id="a0f34b061518d2d9f7b3bd2f57f29e2ce"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#a0f34b061518d2d9f7b3bd2f57f29e2ce">update_setpoints</a> (float current_setpoint, float current_feedrate)</td></tr>
<tr class="memdesc:a0f34b061518d2d9f7b3bd2f57f29e2ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">allows the user to update the current position and feed rate setpoints <br /></td></tr>
<tr class="separator:a0f34b061518d2d9f7b3bd2f57f29e2ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ad867b5bbad347b466fffa58a7652e97b"><td class="memItemLeft" align="right" valign="top"><a id="ad867b5bbad347b466fffa58a7652e97b"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>_setpoint_current</b></td></tr>
<tr class="separator:ad867b5bbad347b466fffa58a7652e97b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b2714768a14334bcba690aae3e5af42"><td class="memItemLeft" align="right" valign="top"><a id="a5b2714768a14334bcba690aae3e5af42"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#a5b2714768a14334bcba690aae3e5af42">_setpoint_last</a></td></tr>
<tr class="memdesc:a5b2714768a14334bcba690aae3e5af42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores current target position (in mm) <br /></td></tr>
<tr class="separator:a5b2714768a14334bcba690aae3e5af42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1c9103d3e82c96981d12a86698fe772"><td class="memItemLeft" align="right" valign="top"><a id="ae1c9103d3e82c96981d12a86698fe772"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#ae1c9103d3e82c96981d12a86698fe772">_feed_setpoint</a></td></tr>
<tr class="memdesc:ae1c9103d3e82c96981d12a86698fe772"><td class="mdescLeft">&#160;</td><td class="mdescRight">stores last target postion (in mm) <br /></td></tr>
<tr class="separator:ae1c9103d3e82c96981d12a86698fe772"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1b4102e495535557e92918f509a1ae5"><td class="memItemLeft" align="right" valign="top"><a id="ad1b4102e495535557e92918f509a1ae5"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#ad1b4102e495535557e92918f509a1ae5">_delta_dist</a></td></tr>
<tr class="memdesc:ad1b4102e495535557e92918f509a1ae5"><td class="mdescLeft">&#160;</td><td class="mdescRight">store the target feed rate for the motor <br /></td></tr>
<tr class="separator:ad1b4102e495535557e92918f509a1ae5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f1b8b186fa99de43237b5209b8d8de8"><td class="memItemLeft" align="right" valign="top"><a id="a1f1b8b186fa99de43237b5209b8d8de8"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#a1f1b8b186fa99de43237b5209b8d8de8">_tot_travel_period</a></td></tr>
<tr class="memdesc:a1f1b8b186fa99de43237b5209b8d8de8"><td class="mdescLeft">&#160;</td><td class="mdescRight">the distance between the current and last setpoints <br /></td></tr>
<tr class="separator:a1f1b8b186fa99de43237b5209b8d8de8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3758bd2e810b2268cdd32c534a9df461"><td class="memItemLeft" align="right" valign="top"><a id="a3758bd2e810b2268cdd32c534a9df461"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#a3758bd2e810b2268cdd32c534a9df461">_ramp_dt_period</a></td></tr>
<tr class="memdesc:a3758bd2e810b2268cdd32c534a9df461"><td class="mdescLeft">&#160;</td><td class="mdescRight">the amount of time required to travel from last to current point based on the current feedrate <br /></td></tr>
<tr class="separator:a3758bd2e810b2268cdd32c534a9df461"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c102317b113c9ef93bba0093c320628"><td class="memItemLeft" align="right" valign="top"><a id="a7c102317b113c9ef93bba0093c320628"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#a7c102317b113c9ef93bba0093c320628">_ramp_sections</a></td></tr>
<tr class="memdesc:a7c102317b113c9ef93bba0093c320628"><td class="mdescLeft">&#160;</td><td class="mdescRight">the dt for each section of the ramp input <br /></td></tr>
<tr class="separator:a7c102317b113c9ef93bba0093c320628"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0ba16c3a88b36fbafb1ab1149762833"><td class="memItemLeft" align="right" valign="top"><a id="ab0ba16c3a88b36fbafb1ab1149762833"></a>
float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#ab0ba16c3a88b36fbafb1ab1149762833">_output_ramp</a></td></tr>
<tr class="memdesc:ab0ba16c3a88b36fbafb1ab1149762833"><td class="mdescLeft">&#160;</td><td class="mdescRight">the number of discrete sections of the ramp input <br /></td></tr>
<tr class="separator:ab0ba16c3a88b36fbafb1ab1149762833"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea7465b4ca0add24e0b51d71c982b083"><td class="memItemLeft" align="right" valign="top"><a id="aea7465b4ca0add24e0b51d71c982b083"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMotionPlanning.html#aea7465b4ca0add24e0b51d71c982b083">_even</a> = false</td></tr>
<tr class="memdesc:aea7465b4ca0add24e0b51d71c982b083"><td class="mdescLeft">&#160;</td><td class="mdescRight">the pointer to the float array of linearly interpollated portions of the overall movement specified between the lines of G-code <br /></td></tr>
<tr class="separator:aea7465b4ca0add24e0b51d71c982b083"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>a class that implements a linearly interpolated ramp input generator for a classical control loop <br  />
 </p>
<p>Generates a lineraly interpolated ramp input for use in P, PI, and PID control loop between two lines of parsed GCODE. This was implemented in the form of a class in order to avoid having to make a large number of static variables and to do cleaner dynamic memory allocation for the array which holds the generated ramp input. By providing our classical control loops with a ramp input instead of a step input we are able to control both position and velocity with a PID postion control loop. Additionally, the classical control loop behaves in a linear manner since it is subjected to several smaller disturbances instead of one large step disturbance. Maintaining linear control loop behavior eases parameterization of the closed loop system as well as reduces the likelyhood for eratic controller behavior due to non-linearities. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ab77d73240b06317f3094028c8adc4b15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab77d73240b06317f3094028c8adc4b15">&#9670;&nbsp;</a></span>MotionPlanning()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MotionPlanning::MotionPlanning </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>setpoint_current</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>setpoint_last</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>feed_setpoint</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ramp_dt_period</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>boolean for how to adjust the index of the dynamically allocated array which stores the ramp input </p>
<p>Motionplanning Class constructor which takes in decoded GCODE inputs and a user set discrete ramp section period.</p>
<p>Save all inputted arguments to class member data from the current and last lines of queued GCODE. Make the pointer to the dynamically allocated array <code>_output_ramp</code> point to NULL in preparation for memory allocation. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">_setpoint_current</td><td>the current position setpoints in [mm] for the motor of interest from the current line of GCODE. </td></tr>
    <tr><td class="paramname">_setpoint_last</td><td>the last position setpoint in [mm] for the motor of interest from the last line of GCODE. <br  />
 </td></tr>
    <tr><td class="paramname">_feed_setpoint</td><td>the current feed rate in [mm/sec] that the laser is commanded to move at from the current line of GCODE. </td></tr>
    <tr><td class="paramname">_ramp_dt_period</td><td>the discrete time period that each section of the ramp output is built with in [microseconds], set by the user. </td></tr>
    <tr><td class="paramname">_ramp_sections</td><td>the number of discrete sections of the ramp input to the control loop generated by the <code><a class="el" href="classMotionPlanning.html#a547647e630d7c33b11ba73b08013f894" title="generates the ramp input to the control loop as a dyanmic array">ramp_generator()</a></code> method </td></tr>
    <tr><td class="paramname">_output_ramp</td><td>the pointer to the dynamically allocated array that holds what will be the ramp input to the control loop that is controlling the motor of interest. Initialized as a null pointer to ensure </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aacc8e431397a8d9b745d7182b86ed415"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacc8e431397a8d9b745d7182b86ed415">&#9670;&nbsp;</a></span>deinit_ramp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MotionPlanning::deinit_ramp </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>deletes the dynamically allocated ramp input array and sets up for the next ramp </p>
<p><br  />
 </p>

</div>
</div>
<a id="a60f1b040d485df34cb53077441568f7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60f1b040d485df34cb53077441568f7b">&#9670;&nbsp;</a></span>init_ramp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MotionPlanning::init_ramp </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>allocates the memory for the ramp input and initalizes output_pointer </p>
<p>calculates the required size of the dynamic array <code>_output_ramp</code> by from the time required to traverse the position change specified by the current and last lines of GCODE and then creates the appropriate sized array to hold the ramp input to the control loop. To get an array with a positve integer for the index a abreviated approximate version of Euclid's algorithm is used to calculate the greatest common factor between the <code>tot_travel_time</code> and <code>_ramp_dt_period</code> . Since the distance and the travel time are both floating point numbers the floating point version of the modulo (%) operator is used - <code>fmodf(float_x,float_y)</code> in the equation that calculates the number of ramp sections <code>_ramp_sections</code> . @</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dist</td><td>the distance between the current and last setpoint in [mm], used to calculate the the time it takes for the laser to traverse the move between the current and last X,Y setpoints from the current and last lines of GCODE. </td></tr>
    <tr><td class="paramname">_even</td><td>a boolean that adjusts how index of the dynamically allocated array, <code>_output_ramp</code> is augmented to include the current setpoint and feed rate. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a547647e630d7c33b11ba73b08013f894"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a547647e630d7c33b11ba73b08013f894">&#9670;&nbsp;</a></span>ramp_generator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MotionPlanning::ramp_generator </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>generates the ramp input to the control loop as a dyanmic array </p>
<p>checks that the ramp should be generated by ensuring the total travel peirod <code>_tot_travel_period</code> is greater than or equal to the discrete ramp period and the dynamic memory allocation was succesful such that the pointer <code>_ouput_ramp</code> is no longer a NULL pointer then, the ramp generator for loop is run and the ramp input for the controller is generated. (this is called output_ramp instead of input ramp because the motion planning class is outputs this, even though it is then taken and inputted into the control loop). </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>a variable to store the length of the dynamic array _output_array. </td></tr>
    <tr><td class="paramname">aug_index</td><td>a variable that adjusts the index based on a specified quantity as a function of the <code>_even</code> boolean - true if the <code>_ramp_dt_period</code> divided evenly into the <code>_tot_travel_period</code> and false if not. </td></tr>
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="motionplanning_8h_source.html">motionplanning.h</a></li>
<li><a class="el" href="motionplanning_8cpp.html">motionplanning.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
